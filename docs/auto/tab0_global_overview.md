# Tab 0: å…¨å±€æ¦‚è§ˆ

## 1. å‰ç«¯æ–¹æ¡ˆ

### 1.1 ç•Œé¢å¸ƒå±€
- **ä½ç½®**ï¼šä½œä¸ºç¬¬ä¸€ä¸ªTabï¼Œæœ€å…ˆå±•ç¤ºç»™ç”¨æˆ·
- **å¸ƒå±€**ï¼šå“åº”å¼ç½‘æ ¼å¸ƒå±€ï¼Œè‡ªé€‚åº”ä¸åŒå±å¹•å°ºå¯¸
- **åˆ·æ–°æœºåˆ¶**ï¼šä¸è‡ªåŠ¨åˆ·æ–°ï¼Œæ”¯æŒæ‰‹åŠ¨åˆ·æ–°

### 1.2 ä¸»è¦ç»„ä»¶
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…¨å±€æ¦‚è§ˆ                             [ä»Šæ—¥ | æœ¬å‘¨ | æœ¬æœˆ] [åˆ·æ–°]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ç»Ÿè®¡å¡ç‰‡åŒºåŸŸï¼ˆ4ä¸ªï¼‰                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚Pipeline     â”‚å‘å¸ƒé…ç½®      â”‚æ‰§è¡Œä»»åŠ¡      â”‚è´¦å·          â”‚      â”‚
â”‚  â”‚    12ä¸ª     â”‚    35ä¸ª     â”‚   1,256ä¸ª    â”‚   8ç»„/45ä¸ª   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                  â”‚
â”‚  å›¾è¡¨åŒºåŸŸï¼ˆ2åˆ—ï¼‰                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ æ‰§è¡ŒæˆåŠŸç‡            â”‚        â”‚ å¹³å°åˆ†å¸ƒ             â”‚       â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 94.5% â”‚        â”‚ YouTube:  78%       â”‚       â”‚
â”‚  â”‚ ä»Šæ—¥: 45/48 æˆåŠŸ      â”‚        â”‚ Bilibili: 22%       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                  â”‚
â”‚  è´¦å·è¡¨ç°TOP5                     æœ€è¿‘æ‰§è¡Œä»»åŠ¡                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚1. yt_001 è§‚çœ‹:12.3K   â”‚        â”‚task_001 âœ… 10åˆ†é’Ÿå‰ â”‚       â”‚
â”‚  â”‚2. yt_002 è§‚çœ‹:10.1K   â”‚        â”‚task_002 ğŸ”„ è¿›è¡Œä¸­   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ç»„ä»¶ç»“æ„
```tsx
// components/AutoPublish/GlobalOverview.tsx
import React, { useState, useEffect } from 'react';
import { Card, Row, Col, Statistic, Progress, List, Tag, Radio } from 'antd';
import { ReloadOutlined } from '@ant-design/icons';

interface OverviewStats {
  pipelines: number;
  configs: number;
  tasks: {
    total: number;
    today: number;
    week: number;
    month: number;
    success: number;
    failed: number;
    running: number;
    pending: number;
  };
  accounts: {
    groups: number;
    total: number;
    active: number;
  };
  platformDistribution: {
    platform: string;
    count: number;
    percentage: number;
  }[];
  successRate: {
    today: number;
    week: number;
    month: number;
  };
}

interface TopAccount {
  account_id: string;
  account_name: string;
  platform: string;
  metrics: {
    views: number;
    likes: number;
    comments: number;
    subscribers_gained: number;
  };
}

interface RecentTask {
  task_id: string;
  pipeline_name: string;
  account_name: string;
  status: 'pending' | 'running' | 'completed' | 'failed';
  created_at: string;
  duration?: number;
}
```

### 1.4 äº¤äº’åŠŸèƒ½
- **ç»Ÿè®¡å¡ç‰‡ç‚¹å‡»**ï¼šè·³è½¬åˆ°å¯¹åº”çš„Tabé¡µé¢
- **æ—¶é—´èŒƒå›´åˆ‡æ¢**ï¼šä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆæ•°æ®åˆ‡æ¢
- **æ‰‹åŠ¨åˆ·æ–°**ï¼šç‚¹å‡»åˆ·æ–°æŒ‰é’®ç«‹å³æ›´æ–°
- **è´¦å·ç‚¹å‡»**ï¼šè·³è½¬åˆ°è´¦å·è¯¦æƒ…
- **ä»»åŠ¡ç‚¹å‡»**ï¼šè·³è½¬åˆ°ä»»åŠ¡è¯¦æƒ…

## 2. éœ€è¦çš„æ¥å£

### 2.1 è·å–æ¦‚è§ˆç»Ÿè®¡
```http
GET /api/auto-publish/overview/stats

Queryå‚æ•°:
  - period: string (today/week/month) é»˜è®¤today

å“åº”ç¤ºä¾‹:
{
  "pipelines": 12,
  "configs": 35,
  "tasks": {
    "total": 1256,
    "today": 48,
    "week": 336,
    "month": 1256,
    "success": 1180,
    "failed": 56,
    "running": 5,
    "pending": 15
  },
  "accounts": {
    "groups": 8,
    "total": 45,
    "active": 42
  },
  "successRate": {
    "today": 93.75,
    "week": 94.2,
    "month": 93.9
  }
}
```

### 2.2 è·å–å¹³å°åˆ†å¸ƒ
```http
GET /api/auto-publish/overview/platform-distribution

Queryå‚æ•°:
  - period: string (today/week/month) é»˜è®¤today

å“åº”ç¤ºä¾‹:
[
  {
    "platform": "youtube",
    "count": 980,
    "percentage": 78.0
  },
  {
    "platform": "bilibili",
    "count": 276,
    "percentage": 22.0
  }
]
```

### 2.3 è·å–è´¦å·TOPæ¦œ
```http
GET /api/auto-publish/overview/top-accounts

Queryå‚æ•°:
  - limit: number (é»˜è®¤5ï¼Œæœ€å¤§10)
  - period: string (today/week/month) é»˜è®¤today
  - metric: string (views/likes/subscribers) é»˜è®¤views

å“åº”ç¤ºä¾‹:
[
  {
    "account_id": "yt_001_novel",
    "account_name": "å°è¯´é¢‘é“1",
    "platform": "youtube",
    "metrics": {
      "views": 12300,
      "likes": 456,
      "comments": 89,
      "subscribers_gained": 234
    }
  }
]
```

### 2.4 è·å–æœ€è¿‘æ‰§è¡Œä»»åŠ¡
```http
GET /api/auto-publish/overview/recent-tasks

Queryå‚æ•°:
  - limit: number (é»˜è®¤10ï¼Œæœ€å¤§20)

å“åº”ç¤ºä¾‹:
[
  {
    "task_id": "task_20241225_001",
    "pipeline_name": "YouTubeæ•…äº‹ç”ŸæˆV3",
    "account_name": "å°è¯´é¢‘é“1",
    "status": "completed",
    "created_at": "2024-12-25T10:30:00Z",
    "duration": 320
  }
]
```

## 3. åç«¯æ‰§è¡Œæµç¨‹

### 3.1 ç»Ÿè®¡æ•°æ®è·å–æµç¨‹
```python
# api_auto_publish.py
@router.get("/overview/stats")
async def get_overview_stats(
    period: str = Query("today", regex="^(today|week|month)$"),
    current_user = Depends(get_current_user)
):
    """è·å–æ¦‚è§ˆç»Ÿè®¡æ•°æ®"""
    db = get_db_manager()
    
    # 1. è®¡ç®—æ—¶é—´èŒƒå›´
    now = datetime.now()
    if period == "today":
        start_date = now.replace(hour=0, minute=0, second=0)
    elif period == "week":
        start_date = now - timedelta(days=7)
    else:  # month
        start_date = now - timedelta(days=30)
    
    # 2. æŸ¥è¯¢Pipelineæ€»æ•°
    pipeline_count = db.query(
        "SELECT COUNT(*) FROM pipeline_registry WHERE status = 'active'"
    )
    
    # 3. æŸ¥è¯¢é…ç½®æ€»æ•°
    config_count = db.query(
        "SELECT COUNT(*) FROM publish_configs WHERE is_active = 1"
    )
    
    # 4. æŸ¥è¯¢ä»»åŠ¡ç»Ÿè®¡
    task_stats = db.query("""
        SELECT 
            COUNT(*) as total,
            SUM(CASE WHEN created_at >= ? THEN 1 ELSE 0 END) as period_count,
            SUM(CASE WHEN pipeline_status = 'completed' THEN 1 ELSE 0 END) as success,
            SUM(CASE WHEN pipeline_status = 'failed' THEN 1 ELSE 0 END) as failed,
            SUM(CASE WHEN pipeline_status = 'running' THEN 1 ELSE 0 END) as running,
            SUM(CASE WHEN pipeline_status = 'pending' THEN 1 ELSE 0 END) as pending
        FROM auto_publish_tasks
        WHERE created_at >= ?
    """, (start_date, start_date))
    
    # 5. æŸ¥è¯¢è´¦å·ç»Ÿè®¡
    account_stats = db.query("""
        SELECT 
            (SELECT COUNT(*) FROM account_groups WHERE is_active = 1) as groups,
            (SELECT COUNT(*) FROM accounts WHERE is_active = 1) as total,
            (SELECT COUNT(DISTINCT account_id) FROM auto_publish_tasks 
             WHERE created_at >= ?) as active
        FROM dual
    """, (start_date,))
    
    # 6. è®¡ç®—æˆåŠŸç‡
    success_rate = (task_stats['success'] / task_stats['period_count'] * 100 
                   if task_stats['period_count'] > 0 else 0)
    
    return {
        "pipelines": pipeline_count,
        "configs": config_count,
        "tasks": task_stats,
        "accounts": account_stats,
        "successRate": success_rate
    }
```

### 3.2 å¹³å°åˆ†å¸ƒè·å–æµç¨‹
```python
@router.get("/overview/platform-distribution")
async def get_platform_distribution(
    period: str = Query("today"),
    current_user = Depends(get_current_user)
):
    """è·å–å¹³å°åˆ†å¸ƒæ•°æ®"""
    db = get_db_manager()
    
    # è®¡ç®—æ—¶é—´èŒƒå›´
    start_date = calculate_start_date(period)
    
    # æŸ¥è¯¢å¹³å°åˆ†å¸ƒ
    results = db.query("""
        SELECT 
            JSON_EXTRACT(pr.supported_platforms, '$[0]') as platform,
            COUNT(apt.task_id) as count
        FROM auto_publish_tasks apt
        JOIN pipeline_registry pr ON apt.pipeline_id = pr.pipeline_id
        WHERE apt.created_at >= ?
        GROUP BY platform
    """, (start_date,))
    
    # è®¡ç®—ç™¾åˆ†æ¯”
    total = sum(r['count'] for r in results)
    for r in results:
        r['percentage'] = round(r['count'] / total * 100, 1) if total > 0 else 0
    
    return results
```

## 4. æ•°æ®æ¨¡å‹

ä½¿ç”¨ç°æœ‰æ•°æ®æ¨¡å‹ï¼Œæ— éœ€æ–°å¢ï¼š
- `pipeline_registry` - Pipelineæ³¨å†Œè¡¨
- `publish_configs` - å‘å¸ƒé…ç½®
- `auto_publish_tasks` - æ‰§è¡Œä»»åŠ¡
- `account_groups` - è´¦å·ç»„
- `accounts` - è´¦å·è¡¨

## 5. æ•°æ®åº“äº¤äº’

### 5.1 æ ¸å¿ƒSQLæŸ¥è¯¢

```sql
-- Pipelineæ€»æ•°
SELECT COUNT(*) as count 
FROM pipeline_registry 
WHERE status = 'active';

-- é…ç½®æ€»æ•°
SELECT COUNT(*) as count 
FROM publish_configs 
WHERE is_active = 1;

-- ä»»åŠ¡ç»Ÿè®¡ï¼ˆæ”¯æŒæ—¶é—´èŒƒå›´ï¼‰
SELECT 
    COUNT(*) as total,
    SUM(CASE WHEN DATE(created_at) = CURRENT_DATE THEN 1 ELSE 0 END) as today,
    SUM(CASE WHEN created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY) THEN 1 ELSE 0 END) as week,
    SUM(CASE WHEN created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY) THEN 1 ELSE 0 END) as month,
    SUM(CASE WHEN pipeline_status = 'completed' THEN 1 ELSE 0 END) as success,
    SUM(CASE WHEN pipeline_status = 'failed' THEN 1 ELSE 0 END) as failed,
    SUM(CASE WHEN pipeline_status = 'running' THEN 1 ELSE 0 END) as running,
    SUM(CASE WHEN pipeline_status = 'pending' THEN 1 ELSE 0 END) as pending
FROM auto_publish_tasks
WHERE created_at >= ?;

-- å¹³å°åˆ†å¸ƒ
SELECT 
    CASE 
        WHEN supported_platforms LIKE '%youtube%' THEN 'youtube'
        WHEN supported_platforms LIKE '%bilibili%' THEN 'bilibili'
        ELSE 'other'
    END as platform,
    COUNT(apt.task_id) as count
FROM auto_publish_tasks apt
JOIN pipeline_registry pr ON apt.pipeline_id = pr.pipeline_id
WHERE apt.created_at >= ?
GROUP BY platform;

-- TOPè´¦å·ï¼ˆåŸºäºä»»åŠ¡æˆåŠŸæ•°ï¼‰
SELECT 
    a.account_id,
    a.account_name,
    a.platform,
    COUNT(apt.task_id) as task_count,
    SUM(CASE WHEN apt.pipeline_status = 'completed' THEN 1 ELSE 0 END) as success_count,
    JSON_EXTRACT(apt.metadata, '$.performance.views') as views
FROM accounts a
JOIN auto_publish_tasks apt ON a.account_id = apt.account_id
WHERE apt.created_at >= ?
  AND apt.pipeline_status = 'completed'
GROUP BY a.account_id
ORDER BY success_count DESC, views DESC
LIMIT ?;

-- æœ€è¿‘æ‰§è¡Œä»»åŠ¡
SELECT 
    apt.task_id,
    pr.pipeline_name,
    a.account_name,
    apt.pipeline_status as status,
    apt.created_at,
    TIMESTAMPDIFF(SECOND, apt.started_at, apt.completed_at) as duration
FROM auto_publish_tasks apt
JOIN pipeline_registry pr ON apt.pipeline_id = pr.pipeline_id
JOIN accounts a ON apt.account_id = a.account_id
ORDER BY apt.created_at DESC
LIMIT ?;
```

## 6. å‰ç«¯å®ç°è¦ç‚¹

### 6.1 è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
```tsx
useEffect(() => {
  // åˆå§‹åŠ è½½
  loadOverviewData();
  
  // è®¾ç½®è‡ªåŠ¨åˆ·æ–°
  const interval = setInterval(() => {
    loadOverviewData();
  }, 30000); // 30ç§’
  
  return () => clearInterval(interval);
}, [period]);
```

### 6.2 è·³è½¬åŠŸèƒ½
```tsx
const handleCardClick = (target: string) => {
  switch(target) {
    case 'pipeline':
      navigate('/auto-publish?tab=pipeline');
      break;
    case 'config':
      navigate('/auto-publish?tab=config');
      break;
    case 'task':
      navigate('/auto-publish?tab=task');
      break;
    case 'account':
      navigate('/auto-publish?tab=account');
      break;
  }
};
```

### 6.3 å“åº”å¼å¸ƒå±€
```tsx
<Row gutter={[16, 16]}>
  <Col xs={24} sm={12} md={6}>
    <Card hoverable onClick={() => handleCardClick('pipeline')}>
      <Statistic title="Pipeline" value={stats.pipelines} suffix="ä¸ª" />
    </Card>
  </Col>
  {/* å…¶ä»–å¡ç‰‡... */}
</Row>
```

## 7. æµ‹è¯•è¦ç‚¹

### 7.1 åŠŸèƒ½æµ‹è¯•
- [ ] æ•°æ®åŠ è½½æ˜¯å¦æ­£å¸¸
- [ ] æ—¶é—´èŒƒå›´åˆ‡æ¢æ˜¯å¦ç”Ÿæ•ˆ
- [ ] è‡ªåŠ¨åˆ·æ–°æ˜¯å¦å·¥ä½œ
- [ ] è·³è½¬åŠŸèƒ½æ˜¯å¦æ­£ç¡®

### 7.2 æ€§èƒ½æµ‹è¯•
- [ ] å¤§æ•°æ®é‡ä¸‹çš„åŠ è½½é€Ÿåº¦
- [ ] å†…å­˜æ³„æ¼æ£€æŸ¥ï¼ˆè‡ªåŠ¨åˆ·æ–°ï¼‰
- [ ] APIå“åº”æ—¶é—´

### 7.3 å…¼å®¹æ€§æµ‹è¯•
- [ ] ä¸åŒå±å¹•å°ºå¯¸çš„å“åº”å¼å¸ƒå±€
- [ ] ä¸åŒæµè§ˆå™¨çš„å…¼å®¹æ€§

## 8. éƒ¨ç½²æ³¨æ„äº‹é¡¹

1. **ç¼“å­˜ç­–ç•¥**ï¼šæ¦‚è§ˆæ•°æ®å¯ä»¥é€‚å½“ç¼“å­˜ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›
2. **æƒé™æ§åˆ¶**ï¼šç¡®ä¿ç”¨æˆ·åªèƒ½çœ‹åˆ°æœ‰æƒé™çš„æ•°æ®
3. **é”™è¯¯å¤„ç†**ï¼šAPIè°ƒç”¨å¤±è´¥æ—¶çš„å‹å¥½æç¤º
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šè€ƒè™‘ä½¿ç”¨Redisç¼“å­˜çƒ­ç‚¹æ•°æ®